import re, json
from docx import Document
from pathlib import Path

# --------- 使�?��????�調??��???????? ---------
DOCX_PATH = Path(r"C:\Users\user1\Downloads\1132B11223209(1).docx")  # 課表 docx �?�?
# �???????�?次�??�?�?�????�?�????�????�????學�?��??�???????�?次代???�?�???��??修�?��??
KEEP_PERIODS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'Z']
# ------------------------------------

def load_docx(path):
    """�???? docx 並�????�表??��?�件"""
    doc = Document(path)
    return doc.tables[0]  # 課表???常�?��?? 1 ??? table

def extract_period_rows(table):
    """
    �?表�?��????��??�?�? ??? row ??�件??????�???? dict�?
    row.cells[0] ??�容�?�? 'B. 09:10 | 10:00'
    """
    mapping = {}
    for row in table.rows:
        first_cell = row.cells[0].text.strip()
        if re.match(r'^[A-Z]\.', first_cell):  # �?�? 'B.'
            period = first_cell.split('.')[0]  # ??? 'B'
            mapping[period] = row
    return mapping

def parse_cell(cell_text):
    """
    �???��?��??�??????��??室代碼�??
      - ?????��?��??裡�?? (EN401-B) ??? EN401-B
      - ??��?????�????�???��???????�代�? ??? EN401
      - �????�???��???????��??�??????? '0'
    """
    cell_text = cell_text.strip()
    if not cell_text:
        return "0"
    m = re.search(r'\(([A-Za-z0-9\-]+)\)', cell_text)
    if m:
        code = m.group(1)
        return code.split("-")[0]  # ?????? -B �?�?
    return "0"

def build_schedule(table):
    """
    �? KEEP_PERIODS ???�?走�????��?��?????�?~??????�? (col 1~5) ??????室代碼�??
    ?????�巢??? list
    """
    period_rows = extract_period_rows(table)
    schedule = []
    for p in KEEP_PERIODS:
        row = period_rows.get(p)
        row_codes = []
        if row:
            cells = row.cells[1:6]  # ??????�???��?????�?
            row_codes = [parse_cell(c.text) for c in cells]
        else:
            row_codes = ["0"] * 5
        schedule.append(row_codes)
    return schedule

# ---- 主�??�? ----
table = load_docx(DOCX_PATH)
schedule_json = build_schedule(table)

print(json.dumps(schedule_json, ensure_ascii=False, indent=2))
